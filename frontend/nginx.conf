server {
    # 80번 포트에서 요청을 받음
    listen 80;

    # =======================================================
    #               Frontend (Vue.js) 서빙 설정
    # =======================================================
    location / {
        # Dockerfile에서 Vue 빌드 결과물을 복사한 경로
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        
        # Vue Router의 History 모드를 위한 설정입니다.
        # URL에 해당하는 파일이 없으면 모두 index.html로 요청을 돌려서
        # Vue가 클라이언트 사이드 라우팅을 처리하게 합니다.
        try_files $uri $uri/ /index.html;
    }

    # =======================================================
    #         Backend API 리버스 프록시 설정 (수정된 부분)
    # =======================================================
    # /api로 시작하는 모든 요청을 백엔드 컨테이너로 전달합니다.
    location /api {
        # [수정된 부분]
        # 'backend-app'을 docker-compose.yml에 정의된 서비스 이름인 'backend'로 변경합니다.
        # 포트는 컨테이너 내부 통신이므로 백엔드 컨테이너의 원래 포트인 '8080'을 사용합니다.
        proxy_pass http://backend:8080;
        
        # 클라이언트의 실제 요청 정보를 백엔드로 그대로 전달하기 위한 헤더 설정입니다.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}